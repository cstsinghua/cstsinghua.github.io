<!DOCTYPE html>
<html>
<head>
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?5bdd93f06ab5180cf97a5e1c1033c6ef"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/">
    
    
    <title>构建spidermonkey指南 | Atypical programmer | 做一个非典型程序员</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="build,构建,Linux,no webview,spidermonkey,hg,embed spidermonkey,Firefox,ubuntu,spidermonkey embedded in Android APP,JS engine,arm,arm64,x86">
    <meta name="description" content="前言随着javascript语言的快速发展，以及跨平台应用的场景越来越广，当前已经出现采用JS engine嵌入移动APP，实现JS编写跨移动平台的应用。比如FaceBook的ReactNative，而Cocos2D引擎也实现了JS的版本Cocos2d-JS。当前主流的JS engine很多，包括v8、spidermonkey、JavascriptCore、Rhino和Nashorn等。
关于J">
<meta property="og:type" content="article">
<meta property="og:title" content="构建spidermonkey指南">
<meta property="og:url" content="https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/index.html">
<meta property="og:site_name" content="Atypical programmer">
<meta property="og:description" content="前言随着javascript语言的快速发展，以及跨平台应用的场景越来越广，当前已经出现采用JS engine嵌入移动APP，实现JS编写跨移动平台的应用。比如FaceBook的ReactNative，而Cocos2D引擎也实现了JS的版本Cocos2d-JS。当前主流的JS engine很多，包括v8、spidermonkey、JavascriptCore、Rhino和Nashorn等。
关于J">
<meta property="og:image" content="https://i.imgur.com/spTwrnj.jpg">
<meta property="og:image" content="https://i.imgur.com/2GYIHJp.jpg">
<meta property="og:image" content="https://i.imgur.com/SqjVtPC.jpg">
<meta property="og:image" content="https://i.imgur.com/qBGsgml.jpg">
<meta property="og:image" content="https://i.imgur.com/nb6sRYK.jpg">
<meta property="og:image" content="https://i.imgur.com/aPTjYxD.jpg">
<meta property="og:image" content="https://i.imgur.com/IfhGD0W.jpg">
<meta property="og:image" content="https://i.imgur.com/ybIVtW1.jpg">
<meta property="og:updated_time" content="2018-05-02T10:16:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="构建spidermonkey指南">
<meta name="twitter:description" content="前言随着javascript语言的快速发展，以及跨平台应用的场景越来越广，当前已经出现采用JS engine嵌入移动APP，实现JS编写跨移动平台的应用。比如FaceBook的ReactNative，而Cocos2D引擎也实现了JS的版本Cocos2d-JS。当前主流的JS engine很多，包括v8、spidermonkey、JavascriptCore、Rhino和Nashorn等。
关于J">
<meta name="twitter:image" content="https://i.imgur.com/spTwrnj.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Atypical programmer" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.1">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cstsinghua</h5>
          <a href="mailto:cstsinghua@126.com" title="cstsinghua@126.com" class="mail">cstsinghua@126.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android"  >
                <i class="icon icon-lg icon-android"></i>
                Android
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Java"  >
                <i class="icon icon-lg icon-coffee"></i>
                Java
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Python"  >
                <i class="icon icon-lg icon-product-hunt"></i>
                Python
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/NodeJS"  >
                <i class="icon icon-lg icon-shield"></i>
                NodeJS
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/版本控制/"  >
                <i class="icon icon-lg icon-git"></i>
                版本控制
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/杂项/"  >
                <i class="icon icon-lg icon-book"></i>
                杂项
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/sitemap.xml"  >
                <i class="icon icon-lg icon-sitemap"></i>
                Sitemap
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/cstsinghua" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://developer.android.com"  >
                <i class="icon icon-lg icon-link"></i>
                Android官网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">构建spidermonkey指南</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="global.search_input_hint">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">构建spidermonkey指南</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-04-25T06:55:51.000Z" itemprop="datePublished" class="page-time">
  2018-04-25
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/tools/">tools</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ubuntu-16-04-LTS系统下构建Firefox-for-Android"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">ubuntu 16.04 LTS系统下构建Firefox for Android</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ubuntu-16-04-LTS系统下构建spidermonkey的shared-library"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">ubuntu 16.04 LTS系统下构建spidermonkey的shared library</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#附录"><span class="post-toc-number">2.</span> <span class="post-toc-text">附录</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-构建spidermonkey指南"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">构建spidermonkey指南</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-04-25 14:55:51" datetime="2018-04-25T06:55:51.000Z"  itemprop="datePublished">2018-04-25</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/tools/">tools</a></li></ul></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <a id="more"></a>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>随着javascript语言的快速发展，以及跨平台应用的场景越来越广，当前已经出现采用JS engine嵌入移动APP，实现JS编写跨移动平台的应用。比如FaceBook的<a href="https://github.com/facebook/react-native" target="_blank" rel="external">ReactNative</a>，而Cocos2D引擎也实现了JS的版本<a href="http://www.cocos.com/docs/js/1-about-cocos2d-js/1-1-a-brief-history/zh.html" target="_blank" rel="external">Cocos2d-JS</a>。当前主流的JS engine很多，包括v8、spidermonkey、JavascriptCore、Rhino和Nashorn等。</p>
<p>关于JS引擎介绍，可以参见维基百科<a href="https://en.wikipedia.org/wiki/JavaScript_engine" title="JavaScript_engine" target="_blank" rel="external">JavaScript_engine介绍</a>。</p>
<p>关于各引擎的对比，可以参见<a href="http://openaphid.github.io/blog/2013/01/17/part-i-how-to-choose-a-javascript-engine-for-ios-and-android-apps/" target="_blank" rel="external">JS engine对比文章1</a>、<a href="https://www.skyscanner.net/blogs/developing-mobile-cross-platform-library-part-3-javascript" target="_blank" rel="external">JS engine简单对比文章2</a>。文章1有人翻译成了中文，请参见<a href="https://blog.csdn.net/Kaitiren/article/details/23255195。" target="_blank" rel="external">https://blog.csdn.net/Kaitiren/article/details/23255195。</a></p>
<p>关于如何选择一个JS engine，这里提几点：</p>
<ol>
<li>引擎的性能，当然是越快越好；</li>
<li>嵌入之后，对APP的包体大小的影响；</li>
<li>该引擎的官方文档是否齐全，API是否清晰好用，是否处于活跃开发阶段，开发社区的支持是否足够</li>
<li>多平台的支持性，比如v8只支持JIT编译，而IOS是限制第三方JS engine使用JIT的。</li>
</ol>
<p>关于v8引擎的构建，请参考<a href="https://cstsinghua.github.io/2018/04/04/%E6%9E%84%E5%BB%BAv8%20engine%E6%8C%87%E5%8D%97/">构建v8 engine指南</a>。</p>
<h2 id="ubuntu-16-04-LTS系统下构建Firefox-for-Android"><a href="#ubuntu-16-04-LTS系统下构建Firefox-for-Android" class="headerlink" title="ubuntu 16.04 LTS系统下构建Firefox for Android"></a>ubuntu 16.04 LTS系统下构建Firefox for Android</h2><p><strong>前提条件：</strong><br>    Hardware requirements<br>        2G RAM with lots of available swap space. Additional RAM will significantly decrease build time.<br>        For debug builds: at least 8 GB free disk space<br>        For optimized builds: at least 1 GB free disk space (6 GB recommended)</p>
<p><strong>注意：实际上，构建很消耗资源，所以建议RAM 8G以上，磁盘空间剩余30G以上。另外网络带宽要比较高，国内的话，最好使用VPN</strong></p>
<p>Mozilla官方也有构建指南，不过其中有些不是很清楚，官方文档请参见<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_for_Android_build" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_for_Android_build</a></p>
<p><strong>具体构建步骤：</strong></p>
<ol>
<li>安装支持32位的相关库（If you’re using a 64-bit Linux, you’ll need to install 32 bit libs to allow the toolchain binaries to run）<blockquote>
<p>sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386 lib32z1 libbz2-1.0:i386</p>
</blockquote>
</li>
<li>获取启动配置的py文件，打开终端，执行如下命令：<blockquote>
<p>wget -O bootstrap.py <a href="https://hg.mozilla.org/mozilla-central/raw-file/default/python/mozboot/bin/bootstrap.py" target="_blank" rel="external">https://hg.mozilla.org/mozilla-central/raw-file/default/python/mozboot/bin/bootstrap.py</a></p>
</blockquote>
</li>
<li><p>确保系统的默认的python版本为2.7(Ubuntu 16.04LTS版本默认安装的python就是2.7，所以这里只需确认下即可)，在终端里执行步骤2中下载的bootstrap.py：</p>
<blockquote>
<p>python #先确认python版本是2.7<br>python bootstrap.py</p>
</blockquote>
<p> 其中，<code>python bootstrap.py</code>会去安装python和autoconf2.13等工具(在执行的终端窗口可以看到<code>sudo apt-get install autoconf2.13 build-essential nodejs python-dev python-pip python-setuptools unzip uuid zip</code>命令被自动执行)，此外还会下载构建所依赖的Android SDK、NDK等，下载过程比较耗时，需要耐心等候。同时，执行途中会弹出如图1提示(请选择3，这里Artifact mode构建更快，3和4的具体区别，请参见<a href="https://developer.mozilla.org/en-US/docs/Artifact_builds" target="_blank" rel="external">Artifact_builds</a>)：<br> <img src="https://i.imgur.com/spTwrnj.jpg" alt=""><br> 其他选项，默认选择Y(是)或者按照终端的提示建议操作，然后继续让命令过程继续执行即可。下面摘录自官方文档的说明：</p>
<pre><code>The bootstrapping script will install system packages, the Android SDK (and NDK, if required), and the currently required versions of the Android platform plus extras. If you want to know more about what Bootstrap.py is doing you can look at our detailed setup instructions. Please follow the steps in the terminal to complete the configuration. If you want to use git, when you are aksed to run the Mercurial configuration wizard, you can select option 2. No.

The bootstrap script will print out configuration options for you when it finishes (more on this below).  For now, copy this configuration text to a safe place and continue on.  You can re-run the bootstrap script to print this information again later.

Once you have all the dependencies installed, you need to clone the Firefox repository.
</code></pre></li>
<li>拉取源码，这里建议采用hg而非Git。<blockquote>
<p>hg clone <a href="https://hg.mozilla.org/mozilla-central" target="_blank" rel="external">https://hg.mozilla.org/mozilla-central</a></p>
</blockquote>
</li>
<li><p>下载完成之后，在源码目录，本文以<code>/usr/local/spidermonkey/mozilla-central</code>为例。在终端下，进入该目录（留意该目录下的mach文件），然后再次执行启动配置命令：</p>
<blockquote>
<p>cd /usr/local/spidermonkey/mozilla-central<br>./mach bootstrap</p>
</blockquote>
<p> 这一步会弹出步骤3中示意图1的选项，仍然选择3即可。</p>
</li>
<li><p>在<code>/usr/local/spidermonkey/mozilla-central</code>目录下，新建一个名为mozconfig的文件，打开该文件，在里面添加入下内容：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Build Firefox <span class="keyword">for</span> Android:</span><br><span class="line">ac_add_options --enable-application=mobile/android</span><br><span class="line">ac_add_options --target=arm-linux-androideabi</span><br><span class="line"></span><br><span class="line"># With the following Android SDK:</span><br><span class="line">ac_add_options --with-android-sdk="/absolute/<span class="built_in">path</span>/to/.mozbuild/android-sdk"</span><br><span class="line"></span><br><span class="line"># Enable artifact building:</span><br><span class="line">ac_add_options --enable-artifact-builds</span><br><span class="line"></span><br><span class="line"># Write build artifacts to:</span><br><span class="line">mk_add_options MOZ_OBJDIR=./objdir-frontend</span><br></pre></td></tr></table></figure>
<p> 注意：上面的Android SDK的路径<code>/absolute/path/to/.mozbuild/android-sdk</code>，需要根据你当前的实际路径做修改。一般而言，步骤3完成之后，会将Android SDK默认安装在你的用户目录即$Home/.mozbuild/下，比如我的就是<code>/home/coulsonchen/.mozbuild/android-sdk-linux</code>。可去该目录下实际确认下。另外，<code>MOZ_OBJDIR=./objdir-frontend</code>，这里是指定构建的目标目录，位于<code>/usr/local/spidermonkey/mozilla-central/objdir-frontend</code>下，<code>objdir-frontend</code>可以修改成你设定的其他名称。</p>
</li>
<li><p>可以修改源码目录下的源码或者配置，修改完成之后，执行构建：</p>
<blockquote>
<p>./mach build</p>
</blockquote>
<p> 构建完成之后，这个时候其实是可以用Android Studio打开Firefox的整个工程的（build过程已经生成了gradle相关文件）。注意：需要在<code>./mach build</code>后执行<code>./mach gradle clean app:assembleLocalWithGeckoBinariesMinApi21PhotonDebug</code>命令，然后通过Android Studio open项目的时候，选择项目的路径为Firefox的源码下载目录，即<code>/usr/local/spidermonkey/mozilla-central</code>。接着就可以通过Android studio开发和构建Firefox了，并且可Debug和Run。具体请参见官方说明<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_for_Android_build" target="_blank" rel="external">构建Firefox For Android</a>的“Developing Firefox for Android in Android Studio”章节部分。<br> <img src="https://i.imgur.com/2GYIHJp.jpg" alt=""></p>
</li>
<li><p>打包成Android的APK文件：</p>
<blockquote>
<p>./mach package</p>
</blockquote>
<p> 生成的APK文件在构建的目标目录下的/dist子目录下，即<code>/usr/local/spidermonkey/mozilla-central/objdir-frontend/dist</code>下，名称类似fennec-61.0a1.en-US.android-arm.apk</p>
</li>
<li><p>安装到Android手机(支持<strong>Android Ice Cream Sandwich (API 15)</strong>及以后版本的手机)</p>
<blockquote>
<p>./mach install</p>
</blockquote>
<p> 可在终端的输出中查看到相关信息，比如：<br> <img src="https://i.imgur.com/SqjVtPC.jpg" alt=""><br> 也可以直接copy步骤8中生成的apk文件，通过adb install安装即可，安装后在手机桌面会生成Firefox的快捷图标。</p>
</li>
<li><p>运行Firefox，在手机上查看效果</p>
<blockquote>
<p>./mach run</p>
</blockquote>
<p>类似效果如下：<br><img src="https://i.imgur.com/qBGsgml.jpg" alt=""><br>也可以直接在手机桌面，点击Firefox的快捷图标，启动浏览器，即可体验试用。</p>
</li>
</ol>
<h2 id="ubuntu-16-04-LTS系统下构建spidermonkey的shared-library"><a href="#ubuntu-16-04-LTS系统下构建spidermonkey的shared-library" class="headerlink" title="ubuntu 16.04 LTS系统下构建spidermonkey的shared library"></a>ubuntu 16.04 LTS系统下构建spidermonkey的shared library</h2><p>前置条件：<br>    1.spidermonkey的源码和Firefox的源码位于是同一个仓库(事实上，Firefox就是内嵌spidermonkey作为JS的执行engine)，因此这里按照“ubuntu 16.04 LTS系统下构建Firefox for Android”的步骤1-4以完成spidermonkey的源码下载。然后安装下面步骤执行：</p>
<p>实施步骤：</p>
<ol>
<li><p>进入源码的js/src子目录(本文示例源码下载存放路径为<code>/usr/local/spidermonkey/mozilla-central</code>)，即<code>/usr/local/spidermonkey/mozilla-central/js/src</code>。依序执行下列命令：</p>
<blockquote>
<p>cd /usr/local/spidermonkey/mozilla-central<br>cd js/src<br>autoconf2.13 </p>
</blockquote>
<p>   spidermonkey当前强制要求使用autoconf2.13，在python bootstrap.py的过程中会自动安装，如果没有成功安装，请单独选择一个目录，然后按照下面方式手工安装(安装成功之后再从终端回到<code>/usr/local/spidermonkey/mozilla-central/js/src</code>目录)：</p>
<blockquote>
<p>wget <a href="http://ftp.gnu.org/gnu/autoconf/autoconf-2.13.tar.gz" target="_blank" rel="external">http://ftp.gnu.org/gnu/autoconf/autoconf-2.13.tar.gz</a><br> tar -xvzf autoconf-2.13.tar.gz<br> cd autoconf-2.13/<br> ./configure –program-suffix=2.13<br> make<br> sudo make install<br> cd /usr/local/spidermonkey/mozilla-central/js/src<br> autoconf2.13</p>
</blockquote>
<pre><code># This name should end with &quot;_OPT.OBJ&quot; to make the version control system ignore it.如果之前已有上一次构建遗留的build_OPT.OBJ目录，可以先`rm -R build_OPT.OBJ`删除之后再新建，避免多次构建直接缓存干扰
</code></pre><blockquote>
<p>rm -R build_OPT.OBJ<br>mkdir build_OPT.OBJ<br>cd build_OPT.OBJ</p>
</blockquote>
</li>
<li><p>先测试构建环境的配置是否OK。通过构建Linux 64位下的库(target system type:x86_64-pc-linux-gnu)来检验:</p>
</li>
</ol>
<ul>
<li><p>2.1、检查配置</p>
<blockquote>
<p>coulsonchen@coulsonchen:/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ$ ../configure</p>
</blockquote>
<p>  执行该命令后，可能遇到下面错误(Only GCC 6.1 or newer is supported (found version 5.4.0))：</p>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Creating Python environment</span><br><span class="line">New python executable <span class="keyword">in</span> /usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ/_virtualenv/bin/python2.<span class="number">7</span></span><br><span class="line">Also creating executable <span class="keyword">in</span> /usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ/_virtualenv/bin/python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br><span class="line">running build_ext</span><br><span class="line">copying build/lib.linux-x86_64-<span class="number">2</span>.<span class="number">7</span>/psutil/_psutil_linux.so -&gt; psutil</span><br><span class="line">copying build/lib.linux-x86_64-<span class="number">2</span>.<span class="number">7</span>/psutil/_psutil_posix.so -&gt; psutil</span><br><span class="line"></span><br><span class="line">Error processing command. Ignoring because optional. (optional:packages.txt:comm/build/virtualenv_packages.txt)</span><br><span class="line">Reexecuting <span class="keyword">in</span> the virtualenv</span><br><span class="line">checking <span class="keyword">for</span> vcs source checkout... hg</span><br><span class="line">checking <span class="keyword">for</span> a shell... /bin/sh</span><br><span class="line">checking <span class="keyword">for</span> host system <span class="built_in">type</span>... x86_64-pc-linux-gnu</span><br><span class="line">checking <span class="keyword">for</span> target system <span class="built_in">type</span>... x86_64-pc-linux-gnu</span><br><span class="line">checking <span class="keyword">for</span> a shell... /bin/sh</span><br><span class="line">checking <span class="keyword">for</span> host system <span class="built_in">type</span>... x86_64-pc-linux-gnu</span><br><span class="line">checking <span class="keyword">for</span> target system <span class="built_in">type</span>... x86_64-pc-linux-gnu</span><br><span class="line">checking <span class="keyword">for</span> android platform directory... no</span><br><span class="line">checking <span class="keyword">for</span> android sysroot directory... no</span><br><span class="line">checking <span class="keyword">for</span> android system directory... no</span><br><span class="line">checking <span class="keyword">for</span> the Android toolchain directory... <span class="keyword">not</span> found</span><br><span class="line">checking <span class="keyword">for</span> android platform directory... no</span><br><span class="line">checking <span class="keyword">for</span> android system directory... no</span><br><span class="line">checking <span class="keyword">for</span> android sysroot directory... no</span><br><span class="line">checking <span class="keyword">for</span> the Android toolchain directory... <span class="keyword">not</span> found</span><br><span class="line">checking <span class="keyword">for</span> vcs source checkout... hg</span><br><span class="line">checking whether cross compiling... no</span><br><span class="line">checking <span class="keyword">for</span> the target C compiler... /usr/bin/gcc</span><br><span class="line">checking whether the target C compiler can be used... no</span><br><span class="line"><span class="function">DEBUG: &lt;<span class="title">truncated</span> - <span class="title">see</span> <span class="title">config.log</span> <span class="title">for</span> <span class="title">full</span> <span class="title">output</span>&gt;</span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">KERNEL</span> "<span class="title">Linux</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">elif</span> <span class="title">_WIN32</span> || <span class="title">__CYGWIN__</span></span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">KERNEL</span> "<span class="title">WINNT</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">elif</span> <span class="title">__NetBSD__</span></span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">KERNEL</span> "<span class="title">NetBSD</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">elif</span> <span class="title">__APPLE__</span></span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">KERNEL</span> "<span class="title">Darwin</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">endif</span></span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">if</span> <span class="title">_MSC_VER</span> || <span class="title">__BYTE_ORDER__</span> == <span class="title">__ORDER_LITTLE_ENDIAN__</span></span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">ENDIANNESS</span> "<span class="title">little</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">elif</span> <span class="title">__BYTE_ORDER__</span> == <span class="title">__ORDER_BIG_ENDIAN__</span></span><br><span class="line"><span class="title">DEBUG</span>: | %<span class="title">ENDIANNESS</span> "<span class="title">big</span>"</span><br><span class="line"><span class="title">DEBUG</span>: | #<span class="title">endif</span></span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">Executing</span>: `/<span class="title">usr</span>/<span class="title">bin</span>/<span class="title">gcc</span> -<span class="title">std</span>=<span class="title">gnu99</span> -<span class="title">E</span> /<span class="title">tmp</span>/<span class="title">conftest._Zswij.c</span>`</span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">COMPILER</span> = <span class="title">gcc</span></span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">VERSION</span> = 5.4.0</span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">STDC_VERSION</span> = 199901<span class="title">L</span></span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">CPU</span> = <span class="title">x86_64</span></span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">KERNEL</span> = <span class="title">Linux</span></span><br><span class="line"><span class="title">DEBUG</span>: <span class="title">ENDIANNESS</span> = <span class="title">little</span></span><br><span class="line"><span class="title">ERROR</span>: <span class="title">Only</span> <span class="title">GCC</span> 6.1 <span class="title">or</span> <span class="title">newer</span> <span class="title">is</span> <span class="title">supported</span> (<span class="title">found</span> <span class="title">version</span> 5.4.0).</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>这里有两种解决办法：
- 用clang替代gcc(添加环境变量指定编译使用的编译器为clang，CC=clang CXX=clang++  ../configure，即在./configure前面加上`CC=clang CXX=clang++`)，如下所示：
    &gt; coulsonchen@coulsonchen:/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ$ CC=clang CXX=clang++  ../configure

        Reexecuting in the virtualenv
        checking for vcs source checkout... hg
        checking for a shell... /bin/sh
        checking for host system type... x86_64-pc-linux-gnu
        checking for target system type... x86_64-pc-linux-gnu
        checking for a shell... /bin/sh
        checking for host system type... x86_64-pc-linux-gnu
        checking for target system type... x86_64-pc-linux-gnu
        checking for android platform directory... no
        checking for android sysroot directory... no
        checking for android system directory... no
        checking for the Android toolchain directory... not found
        checking for android platform directory... no
        checking for android system directory... no
        checking for android sysroot directory... no
        checking for the Android toolchain directory... not found
        checking for vcs source checkout... hg
        checking whether cross compiling... no
        checking for the target C compiler... not found
        DEBUG: _cc: Trying clang
        ERROR: Cannot find the target C compiler
    这里提示找不到clang编译器，那么就通过命令安装即可(`sudo apt-get install clang`)。当然也可以使用Android ndk目录下自带的clang。
- 更新gcc至6.1之后的版本，请参见[https://blog.csdn.net/gatieme/article/details/52871438](https://blog.csdn.net/gatieme/article/details/52871438)
</code></pre><ul>
<li><p>2.2、构建(make)，检查是否构建成功并测试构建出来的可执行程序是否可用。注：依然在目录<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ</code>下执行终端命令：</p>
<blockquote>
<p>make</p>
</blockquote>
<p>  构建的时间比较长，需要耐心等待。待完成之后，在<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ</code>的子目录<code>/dist/bin</code>下可看到生成了名为js的可执行程序(javascript的交互命令行)，另外也生成了spidermonkey的分享库(shared library)libmozjs-xxx.so(在<code>/dist/bin</code>子目录下，其中xx表示当前源码的版本，如采用Mozilla源码45，那么就是libmozjs-45.so，嵌入其他C++程序使用的时候可以将其改名为libmozjs.so)执行如下命令：</p>
<blockquote>
<p>./dist/bin/js ../Y.js</p>
</blockquote>
<p>  可看到输出信息“5! is 120”。执行执行<code>./dist/bin/js</code>就进入了javascript的交互命令行，在交互命令行里面可以执行javascript的语句，定义函数等等。和python的交互命令行类似。<br>  <img src="https://i.imgur.com/nb6sRYK.jpg" alt=""></p>
</li>
</ul>
<p><strong>3.</strong>先清除之前的配置缓存<br>如果是重新下载的源码，第一次执行的时候可以不用担心。但多次构建时该步骤一定要引起重视。所以为了保险起见，在构建目录<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ</code>的终端下执行：</p>
<blockquote>
<p>rm ./config.cache</p>
</blockquote>
<p><strong>4.</strong> 修改构建Android库的配置参数<br>因为这里涉及到交叉编译，即在Linux Host主机上构建target为Android arm(或arm64，或x86)平台的库。这里首先需要弄清楚，配置脚本有哪些参数是可以配置，哪些参数又是针对构建Android平台库时必须设置的呢？</p>
<p>我们可以通过运行如下命令来检查所有的参数：</p>
<blockquote>
<p>../configure –help<br>../configure –help |grep reStr  </p>
</blockquote>
<p>其中reStr是需要过滤的字符串，比如要查看Android相关的参数</p>
<blockquote>
<p>../configure –help |grep android</p>
</blockquote>
<p><img src="https://i.imgur.com/aPTjYxD.jpg" alt=""></p>
<p>最终配置交叉编译Android arm平台库的参数命令如下(反复尝试，查阅多个文章才得出，这个过程很艰难，稍微多了或者少了某个参数，或者参数错误，都可能导致配置失败，进而也无法进行make构建)： </p>
<blockquote>
<p>../configure –with-android-sdk=”/home/coulsonchen/.mozbuild/android-sdk-linux”   –with-android-ndk=”/home/coulsonchen/.mozbuild/android-ndk-r15c” –with-android-version=23  –with-android-toolchain=/home/coulsonchen/.mozbuild/android-ndk-r15c/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 –target=arm-linux-androideabi</p>
</blockquote>
<p>如果是编译Android arm64平台库，则应该修改为：</p>
<blockquote>
<p>../configure –with-android-sdk=”/home/coulsonchen/.mozbuild/android-sdk-linux”   –with-android-ndk=”/home/coulsonchen/.mozbuild/android-ndk-r15c” –with-android-version=23  –with-android-toolchain=/home/coulsonchen/.mozbuild/android-ndk-r15c/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64 –target=aarch64-linux-android</p>
</blockquote>
<p>即目标平台target和with-android-toolchain参数需要根据目标平台变化而相应修改。<strong>Android ndk r15c(目前spidermonkey构建采用的ndk版本)</strong>支持的目标平台可去其路径下(<code>/home/coulsonchen/.mozbuild/android-ndk-r15c/toolchains</code>)查看：<br><img src="https://i.imgur.com/IfhGD0W.jpg" alt=""></p>
<p><strong>注意：x86 for Android的名称应该为i386-linux-android</strong></p>
<p><strong>5.</strong> 完成最终构建(make)</p>
<blockquote>
<p>make</p>
</blockquote>
<p><strong>注：在默认情况下，这一步构建会出现异常，且该问题很难找到原因，目前官方也没有给出解答，在网上也几乎找不到类似问题。这里有几个回避的方案：</strong></p>
<ul>
<li><strong>异常现象：</strong><br>  执行<code>make</code>之后，构建一段时间，可以在终端看到，因为异常退出了，并没有真正成功构建。异常信息截取如下(其中第一行是整个链接命令)：<pre><code>/home/coulsonchen/.mozbuild/android-ndk-r15c/toolchains/llvm/prebuilt/linux-x86_64/bin/clang++ -std=gnu++14 --target=arm-linux-androideabi -Qunused-arguments -isystem /home/coulsonchen/.mozbuild/android-ndk-r15c/platforms/android-23/arch-arm/usr/include -isystem /home/coulsonchen/.mozbuild/android-ndk-r15c/platforms/android-23/arch-arm/usr/include -gcc-toolchain /usr/local/my-android-toolchain -D__ANDROID_API__=23 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -Qunused-arguments -Wall -Wempty-body -Wignored-qualifiers -Woverloaded-virtual -Wpointer-arith -Wsign-compare -Wtype-limits -Wunreachable-code -Wunreachable-code-return -Wwrite-strings -Wno-invalid-offsetof -Wclass-varargs -Wloop-analysis -Wc++1z-compat -Wcomma -Wimplicit-fallthrough -Wstring-conversion -Wno-inline-new-delete -Wno-error=deprecated-declarations -Wno-error=array-bounds -Wformat -Wformat-security -Wno-gnu-zero-variadic-macro-arguments -Wno-unknown-warning-option -Wno-return-type-c-linkage -fno-sized-deallocation -fno-short-enums -fno-exceptions -I/home/coulsonchen/.mozbuild/android-ndk-r15c/sources/cxx-stl/llvm-libc++/include -I/home/coulsonchen/.mozbuild/android-ndk-r15c/sources/android/support/include -I/home/coulsonchen/.mozbuild/android-ndk-r15c/sources/cxx-stl/llvm-libc++abi/include -march=armv7-a -mthumb -mfpu=vfpv3-d16 -mfloat-abi=softfp -mno-unaligned-access -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fno-rtti -fno-exceptions -fno-math-errno -pipe -g -O3 -funwind-tables  -fPIC -shared -Wl,-z,defs -Wl,-h,libmozjs-61a1.so -o libmozjs-61a1.so /usr/local/gecko-dev/js/src/obj/js/src/build/libmozjs-61a1_so.list  -L/home/coulsonchen/.mozbuild/android-ndk-r15c/platforms/android-23/arch-arm/usr/lib -Wl,-rpath-link=/home/coulsonchen/.mozbuild/android-ndk-r15c/platforms/android-23/arch-arm/usr/lib --sysroot=/home/coulsonchen/.mozbuild/android-ndk-r15c/platforms/android-23/arch-arm -Wl,--allow-shlib-undefined -gcc-toolchain /usr/local/my-android-toolchain -mthumb -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,--build-id -B /usr/local/gecko-dev/js/src/obj/build/unix/gold -Wl,-rpath-link,/usr/local/gecko-dev/js/src/obj/dist/bin -Wl,-rpath-link,/usr/local/lib     ../../../mozglue/build/libmozglue.so   -lm  -lz -llog -lm -ldl -L/home/coulsonchen/.mozbuild/android-ndk-r15c/sources/cxx-stl/llvm-libc++/libs/armeabi-v7a -lc++_static -lc++abi -lunwind -landroid_support
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
../../../build/unix/gold/ld: error: hidden symbol &apos;__android_log_print&apos; is not defined locally
clang++: error: linker command failed with exit code 1 (use -v to see invocation)
/usr/local/spidermonkey/mozilla-central/config/rules.mk:699: recipe for target &apos;libmozjs-60a1.so&apos; failed
make[3]: *** [libmozjs-60a1.so] Error 1
make[3]: Leaving directory &apos;/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ/js/src/build&apos;
/usr/local/spidermonkey/mozilla-central/config/recurse.mk:73: recipe for target &apos;js/src/build/target&apos; failed
make[2]: *** [js/src/build/target] Error 2
make[2]: Leaving directory &apos;/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ&apos;
/usr/local/spidermonkey/mozilla-central/config/recurse.mk:32: recipe for target &apos;compile&apos; failed
make[1]: *** [compile] Error 2
make[1]: Leaving directory &apos;/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ&apos;
/usr/local/spidermonkey/mozilla-central/config/rules.mk:434: recipe for target &apos;default&apos; failed
make: *** [default] Error 2
</code></pre></li>
<li>问题分析：<br>  根据报错信息，可以看出是在链接生成<code>libmozjs-60a1.so</code>(60a1是源码的版本号，版本是xx，那么应该对应libmozjs-xx.so)的时候出错，且都是<code>error: hidden symbol &#39;__android_log_print&#39; is not defined locally</code>错误，我们知道<code>__android_log_print</code>是Android的log库里面提供的日志打印方法。但查询ndk的目录，log库和工具类设置都是正常的，也能找到相关的头文件。且这个错误的信息对于不熟悉C++的人来说，简直一头雾水，在网上查询也几乎找不到像样的解释(Stack Overflow上<a href="https://stackoverflow.com/questions/23696585/what-does-exactly-the-warning-mean-about-hidden-symbol-being-referenced-by-dso" target="_blank" rel="external">有一篇帖子</a>对hidden symbol的问题做了较好的解释，比较有启发性，这里不做具体阐述)。</li>
<li><p>解决(回避)的方案：</p>
<ol>
<li>既然，是引用Android log库的<code>__android_log_print</code>方法，那我们直接注释掉相关引用，绕过去，不就可以解决该问题吗。初步想来，该方法是可行的，因为日志打印只是辅助调试，对功能使用不影响。那么首先需要找出spidermonkey源码里面引用到<code>__android_log_print</code>的地方。这里可以直接利用工具在源码目录下面搜索，也可以通过在终端copy上面提到的链接命令，将其中的<code>-llog</code>去掉(也就是不再链接Android的log库)，然后执行该链接命令，可以看到有类似下图的报错(注意，图中源码存放路径和本文的源码存放路径不同)：<br><img src="https://i.imgur.com/ybIVtW1.jpg" alt=""><br>这说明，去掉链接log库之后，由于<code>__android_log_print</code>未定义，所以肯定报错<code>undefined reference to __android_log_print</code>，但是这给我们提供了信息，即spidermonkey的哪些源码文件引用了<code>__android_log_print</code>，直接找到这些地方，将其注释掉(目前发现在两个文件中存在引用<code>__android_log_print</code>，一是<code>/usr/local/spidermonkey/mozilla-central/js/src/vm/JSContext.cpp</code>，二是构建目录下头文件<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ/dist/include/mozilla/Assertions.h</code>，其实是链接到<code>/usr/local/spidermonkey/mozilla-central/mfbt/Assertions.h</code>)。注释掉这些地方之后，再次执行make，应该就可以成功了(最终会生成交互命令行的可执行程序<code>js</code>和<code>libmozjs-xx.so</code>分享库)。</li>
<li>上面提到Stack Overflow上<a href="https://stackoverflow.com/questions/23696585/what-does-exactly-the-warning-mean-about-hidden-symbol-being-referenced-by-dso" target="_blank" rel="external">这篇帖子</a>解释了hidden symbol的问题，主要是与分享库有关，那么我们是不是可以生成static library来绕过这个问题呢，生成静态库只需要在配置命令加一个参数即可，请参见下面章节的描述。不过这种方法，暂无验证是否有效。</li>
<li>直接从make构建的异常信息入手，找到相关的Makefile文件及其引用的.mk文件，找到链接生成libmozjs-xx.so的命令所在处(mk文件内的具体行)，弄清楚其中的逻辑，然后修改Makefile文件，再次执行make构建即可。不过这个方法非常费事，对C++和make构建不熟悉的话难度非常大，不建议采用。</li>
</ol>
</li>
</ul>
<p>构建完成之后，在构建目录(<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ</code>)下(或在其子目录<code>dist/bin</code>和<code>js/src/build</code>下，<code>dist/bin</code>下其实是一个链接文件，最终链接到<code>js/src/build</code>下的libmozjs-xxx.so)，可以找到生成的libmozjs-xxx.so共享库，此时在Android studio中新建支持cpp的工程，把libmozjs-xxx.so和spidermonkey的相关头文件(位于<code>/usr/local/spidermonkey/mozilla-central/js/src/build_OPT.OBJ/dist/include</code>，其实最终链接到源码目录即<code>/usr/local/spidermonkey/mozilla-central/js/src</code>下的头文件，这些头文件不一定全部复制，可根据实际需要选取要引用到的) copy进去，通过NDK连接，然后就可以实现嵌入spidermonkey engine到Android APP，在APP里面执行javascript的代码了。简单的demo请参见<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/How_to_embed_the_JavaScript_engine" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/How_to_embed_the_JavaScript_engine</a></p>
<p>如果要生成static库(.a格式)而不是shared库，那么在步骤4中，还应该添加一个参数(–disable-shared-js)，示例：</p>
<blockquote>
<p>../configure –with-android-sdk=”/home/coulsonchen/.mozbuild/android-sdk-linux”   –with-android-ndk=”/home/coulsonchen/.mozbuild/android-ndk-r15c” –with-android-version=23  –with-android-toolchain=/home/coulsonchen/.mozbuild/android-ndk-r15c/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 –target=arm-linux-androideabi –disable-shared-js</p>
</blockquote>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Build_Documentation" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Build_Documentation</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_for_Android_build" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Simple_Firefox_for_Android_build</a></li>
<li><a href="http://mozilla.6506.n7.nabble.com/How-to-build-SpiderMonkey-for-Android-arm64-td333026.html" target="_blank" rel="external">http://mozilla.6506.n7.nabble.com/How-to-build-SpiderMonkey-for-Android-arm64-td333026.html</a></li>
<li><a href="https://developer.android.com/ndk/downloads/older_releases.html#ndk-15c-downloads" target="_blank" rel="external">https://developer.android.com/ndk/downloads/older_releases.html#ndk-15c-downloads</a></li>
</ol>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    post.last_updated<time datetime="2018-05-02T10:16:00.000Z" itemprop="dateUpdated">2018-05-02 18:16:00</time>
</span><br>


        
    </div>
    <footer>
        <a href="https://cstsinghua.github.io">
            <img src="/img/logo.jpg" alt="Cstsinghua">
            Cstsinghua
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Firefox/">Firefox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS-engine/">JS engine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arm/">arm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arm64/">arm64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/embed-spidermonkey/">embed spidermonkey</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hg/">hg</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/no-webview/">no webview</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spidermonkey/">spidermonkey</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spidermonkey-embedded-in-Android-APP/">spidermonkey embedded in Android APP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/x86/">x86</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/构建/">构建</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&title=《构建spidermonkey指南》 — Atypical programmer&pic=https://cstsinghua.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&title=《构建spidermonkey指南》 — Atypical programmer&source=写给典型的程序员" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《构建spidermonkey指南》 — Atypical programmer&url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&via=https://cstsinghua.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/04/13/编译v8遇到的错误汇总/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">编译及嵌入v8遇到的错误汇总</h4>
      </a>
    </div>
  
</nav>



    





<section class="comments" id="comments">
    <!-- UY BEGIN -->
    <div id="uyan_frame"></div>
    <script src="http://v2.uyan.cc/code/uyan.js?uid=2146219"></script>
    <!-- UY END -->
</section>







    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "4DjAfnIwjxGfITAYl8eVX5Pe-gzGzoHsz",
            appKey: "ss62qxcFEjf5opJ4Ii5xI2zn",
            avatar: "mm",
            placeholder: "欢迎交流",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        Thanks~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cstsinghua &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&title=《构建spidermonkey指南》 — Atypical programmer&pic=https://cstsinghua.github.io/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&title=《构建spidermonkey指南》 — Atypical programmer&source=写给典型的程序员" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《构建spidermonkey指南》 — Atypical programmer&url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/&via=https://cstsinghua.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://cstsinghua.github.io/2018/04/25/构建spidermonkey指南/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1259817891&web_id=1259817891')

</script>

<script src="/js/main.min.js?v=1.7.1"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.1" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
