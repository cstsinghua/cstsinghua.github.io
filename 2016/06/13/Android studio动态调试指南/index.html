<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android studio动态调试 | Atypical programmer | 做一个非典型程序员</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  <meta name="keywords" content="动态调试">
  <meta name="description" content="Android studio动态调试Android studio动态调试实际上是基于Smali Debugging，而Smali Debugging基于开源的Android反编译工具apktool。
SmaliDebugging has been marked as deprecated in 2.0.3, and will be removed in 2.1. Alternative tool(">
<meta property="og:type" content="article">
<meta property="og:title" content="Android studio动态调试">
<meta property="og:url" content="http://cstsinghua.github.io/2016/06/13/Android studio动态调试指南/index.html">
<meta property="og:site_name" content="Atypical programmer">
<meta property="og:description" content="Android studio动态调试Android studio动态调试实际上是基于Smali Debugging，而Smali Debugging基于开源的Android反编译工具apktool。
SmaliDebugging has been marked as deprecated in 2.0.3, and will be removed in 2.1. Alternative tool(">
<meta property="og:updated_time" content="2016-06-13T07:26:02.974Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android studio动态调试">
<meta name="twitter:description" content="Android studio动态调试Android studio动态调试实际上是基于Smali Debugging，而Smali Debugging基于开源的Android反编译工具apktool。
SmaliDebugging has been marked as deprecated in 2.0.3, and will be removed in 2.1. Alternative tool(">
  
    <link rel="alternative" href="/atom.xml" title="Atypical programmer" type="application/atom+xml">
  
  <meta name="summary" content="写给典型的程序员">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="loading" class="active"></div>

  <nav id="menu" class="hide" >
   <div class="inner flex-row-vertical">
  <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
      <i class="icon icon-lg icon-close"></i>
  </a>
  <div class="brand-wrap">
    <div class="brand">
      <a href="/" class="avatar"><img src="/img/logo.jpg"></a>
      <hgroup class="introduce">
        <h5 class="nickname">Cstsinghua</h5>
        <a href="mailto:undefined" title="cstsinghua@126.com" class="mail">cstsinghua@126.com</a>
      </hgroup>
    </div>
  </div>
  <ul class="nav flex-col">
    
        <li class="waves-block waves-effect">
          <a href="/"  >
            <i class="icon icon-lg icon-home"></i>
            主页
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/archives"  >
            <i class="icon icon-lg icon-archives"></i>
            Archives
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/categories/Android"  >
            <i class="icon icon-lg icon-android"></i>
            Android
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/categories/Java"  >
            <i class="icon icon-lg icon-coffee"></i>
            Java
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/categories/Python"  >
            <i class="icon icon-lg icon-product-hunt"></i>
            Python
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/categories/NodeJS"  >
            <i class="icon icon-lg icon-shield"></i>
            NodeJS
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/categories/杂项/"  >
            <i class="icon icon-lg icon-book"></i>
            杂项
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/tags/index.html"  >
            <i class="icon icon-lg icon-tags"></i>
            Tags
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="/sitemap.xml"  >
            <i class="icon icon-lg icon-sitemap"></i>
            Sitemap
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="https://github.com/cstsinghua" target="_blank" >
            <i class="icon icon-lg icon-github"></i>
            Github
          </a>
        </li>
    
        <li class="waves-block waves-effect">
          <a href="https://developer.android.com"  >
            <i class="icon icon-lg icon-link"></i>
            Android官网
          </a>
        </li>
    
  </ul>

  <footer class="footer">
  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>
  <p>Atypical programmer &copy; 2016</p>
  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme
  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>
  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>
</footer>

</div>

  </nav>
  <main id="main">
    <header class="header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android studio动态调试</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input " autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header">
  <div class="container">
    <h1 class="author">Android studio动态调试</h1>
    <h5 class="subtitle">
          
            <time datetime="2016-06-13T07:25:56.000Z" itemprop="datePublished" class="page-time">
  2016-06-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>
 
        
    </h5>
  </div>
</header>

    <div class="container body-wrap">
      <article id="post-Android studio动态调试指南" 
  class="article article-type-post" itemprop="blogPost">
    <div class="post-meat flex-row">
        
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/动态调试/">动态调试</a></li></ul>

    </div>
    <div class="post-body">
        <aside class="post-widget" id="post-widget">

            
            <div class="post-share" id="post-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>

            

            
            <nav class="post-toc-wrap" id="post-toc">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Android-studio动态调试"><span class="post-toc-text">Android studio动态调试</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#General-information-概述"><span class="post-toc-text">General information(概述)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#General-instructions-一般性步骤"><span class="post-toc-text">General instructions(一般性步骤)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#IntelliJ-Android-Studio-instructions-针对Android-studio的操作步骤"><span class="post-toc-text">IntelliJ (Android Studio) instructions(针对Android studio的操作步骤)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Netbeans-instructions-针对Netbeans的操作步骤"><span class="post-toc-text">Netbeans instructions(针对Netbeans的操作步骤)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Limitations-Issues-限制和已知问题"><span class="post-toc-text">Limitations/Issues(限制和已知问题)</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#apktool-2-1-0之后版本动态调试-适用于Android-studio"><span class="post-toc-text">apktool 2.1.0之后版本动态调试(适用于Android studio)</span></a>
            </nav>
            
        </aside>

        <div class="post-main">

            <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Android-studio动态调试"><a href="#Android-studio动态调试" class="headerlink" title="Android studio动态调试"></a>Android studio动态调试</h2><p>Android studio动态调试实际上是基于Smali Debugging，而Smali Debugging基于开源的Android反编译工具apktool。</p>
<p><strong>SmaliDebugging has been marked as deprecated in 2.0.3, and will be removed in 2.1. Alternative tool(s) will be linked on 2.1 release.</strong> </p>
<p>Apktool makes possible to debug smali code step by step, watch variables, set breakpoints, etc.</p>
<p>本文出自apktool官方网站说明<a href="http://ibotpeaches.github.io/Apktool/documentation/" title="smali debugging" target="_blank" rel="external">http://ibotpeaches.github.io/Apktool/documentation/</a></p>
<h2 id="General-information-概述"><a href="#General-information-概述" class="headerlink" title="General information(概述)"></a>General information(概述)</h2><ul>
<li>Generally we need several things to run Java debugging session: </li>
</ul>
<pre><code>1. debugger server (usually Java VM)
2. debugger client (usually IDE like IntelliJ, Eclipse or Netbeans)
3. client must have sources of debugged application
4. server must have binaries compiled with debugging symbols referencing these sources
5. sources must be java files with at least package and class definitions, to properly connect them with debugging symbols
</code></pre><ul>
<li>In our particular situation we have: <ol>
<li>server: Monitor (Previously DDMS), part of Android SDK, standard for debugging Android applications - explained here</li>
<li>client: any JPDA client - most of decent IDEs have support for this protocol.</li>
<li>sources: smali code modified by apktool to satisfy above requirements (“.java” extension, class declaration, etc.). Apktool modifies them when decoding apk in debug mode.</li>
<li>binaries: when building apk in debug mode, apktool removes original symbols and adds new, which are referencing smali code (line numbers, registers/variables, etc.)</li>
</ol>
</li>
</ul>
<p><em>*Info</em>:* </p>
<pre><code>To successfully run debug sessions, the apk must be both decoded and built in debug mode. Decoding with debug decodes the application differently to allow the debug rebuild option to inject lines allowing the debugger to identify variables and types.-d / --debug
</code></pre><h2 id="General-instructions-一般性步骤"><a href="#General-instructions-一般性步骤" class="headerlink" title="General instructions(一般性步骤)"></a>General instructions(一般性步骤)</h2><p>Above information is enough to debug smali code using apktool, but if you aren’t familiar with DDMS and Java debugging, then you probably still don’t know how to do it. Below are simple instructions for doing it using IntelliJ or Netbeans. </p>
<ol>
<li>Decode apk in debug mode: $ apktool d -d -o out app.apk</li>
<li>Build new apk in debug mode: $ apktool b -d out</li>
<li>Sign, install and run new apk.</li>
<li><strong>Follow sub-instructions below depending on IDE.</strong><h3 id="IntelliJ-Android-Studio-instructions-针对Android-studio的操作步骤"><a href="#IntelliJ-Android-Studio-instructions-针对Android-studio的操作步骤" class="headerlink" title="IntelliJ (Android Studio) instructions(针对Android studio的操作步骤)"></a>IntelliJ (Android Studio) instructions(针对Android studio的操作步骤)</h3></li>
</ol>
<ol>
<li>In IntelliJ add new Java Module Project selecting the “out” directory as project location and the “smali” subdirectory as content root dir.</li>
</ol>
<ol>
<li>Run Monitor (Android SDK /tools folder), find your application on a list and click it. Note port information in last column - it should be something like “86xx / 8700”.</li>
</ol>
<ol>
<li>In IntelliJ: Debug -&gt; Edit Configurations. Since this is a new project, you will have to create a Debugger.</li>
</ol>
<ol>
<li>Create a Remote Debugger, with the settings on “Attach” and setting the Port to 8700 (Or whatever Monitor said). The rest of fields should be ok, click “Ok”.</li>
</ol>
<ol>
<li>Start the debugging session. You will see some info in a log and debugging buttons will show up in top panel.</li>
</ol>
<ol>
<li>Set breakpoint. You must select line with some instruction, you can’t set breakpoint on lines starting with “.”, “:” or “#”.</li>
</ol>
<ol>
<li>Trigger some action in application. If you run at breakpoint, then thread should stop and you will be able to debug step by step, watch variables, etc.</li>
</ol>
<h3 id="Netbeans-instructions-针对Netbeans的操作步骤"><a href="#Netbeans-instructions-针对Netbeans的操作步骤" class="headerlink" title="Netbeans instructions(针对Netbeans的操作步骤)"></a>Netbeans instructions(针对Netbeans的操作步骤)</h3><ol>
<li>In Netbeans add new Java Project with Existing Sources, select “out” directory as project root and “smali” subdirectory as sources dir.</li>
</ol>
<ol>
<li>Run DDMS, find your application on a list and click it. Note port information in last column - it should be something like “86xx / 8700”.</li>
</ol>
<ol>
<li>In Netbeans: Debug -&gt; Attach Debugger -&gt; select JPDA and set Port to 8700 (or whatever you saw in previous step). Rest of fields should be ok, click “Ok”.</li>
</ol>
<ol>
<li>Debugging session should start: you will see some info in a log and debugging buttons will show up in top panel.</li>
</ol>
<ol>
<li>Set breakpoint. You must select line with some instruction, you can’t set breakpoint on lines starting with “.”, “:” or “#”.</li>
</ol>
<ol>
<li>Trigger some action in application. If you run at breakpoint, then thread should stop and you will be able to debug step by step, watch variables, etc.</li>
</ol>
<h2 id="Limitations-Issues-限制和已知问题"><a href="#Limitations-Issues-限制和已知问题" class="headerlink" title="Limitations/Issues(限制和已知问题)"></a>Limitations/Issues(限制和已知问题)</h2><p>Because IDE doesn’t have full sources, it doesn’t know about class members and such.<br>Variables watching works because most of data could be read from memory (objects in Java know about their types), but if for example, you watch an object and it has some nulled member, then you won’t see, what type this member is.</p>
<h1 id="apktool-2-1-0之后版本动态调试-适用于Android-studio"><a href="#apktool-2-1-0之后版本动态调试-适用于Android-studio" class="headerlink" title="apktool 2.1.0之后版本动态调试(适用于Android studio)"></a>apktool 2.1.0之后版本动态调试(适用于Android studio)</h1><p>官方地址参见<a href="https://github.com/JesusFreke/smali/wiki/smalidea" target="_blank" rel="external">https://github.com/JesusFreke/smali/wiki/smalidea</a></p>

            <blockquote>
                <p>
                本文地址：
                <a href="http://cstsinghua.github.io/2016/06/13/Android studio动态调试指南/" target="_blank" rel="external">http://cstsinghua.github.io/2016/06/13/Android studio动态调试指南/</a>
                </p>
                <footer><cite><a href="http://cstsinghua.github.io">@Atypical programmer</a></cite></footer>
            </blockquote>
            </div>
            
<nav class="post-nav">
  
    <div class="waves-block waves-effect prev fl">
      <a href="/2016/06/13/Android安装APK详解/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android安装APK详解</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next fr">
      <a href="/2016/06/13/Android APK瘦身初探/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Android APK瘦身策略</h4>
      </a>
    </div>
  
</nav>


            
            
<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Android studio动态调试指南" data-title="Android studio动态调试" data-url="http://cstsinghua.github.io/2016/06/13/Android studio动态调试指南/index.html"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"cstsinghua"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>





        </div>
    </div>
</article>
    </div>
  </main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>

<script>
var BLOG_SHARE = {
    title: "Android studio动态调试",
    pic: "/img/logo.jpg",
    summary: document.getElementsByName('summary')[0].content,
    url: "http://cstsinghua.github.io/2016/06/13/Android studio动态调试指南/index.html"
};
</script>
<div class="global-share" id="global-share">
    <div class="tit">分享到：</div>
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" href="javascript:;" data-title="微博" data-service="tsina">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns" href="javascript:;" data-title="微信" data-service="weixin">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="douban share-sns" href="javascript:;" data-title="豆瓣" data-service="douban">
          豆
        </a>
      </li>
    </ul>
 </div>



<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script src="/js/main.js"></script>



<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<script type="text/template" id="search-tpl">
<li class="item">
    <a href="/{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</script>

<script src="/js/search.js"></script>





<script src="http://s95.cnzz.com/z_stat.php?id=1259817891&web_id=1259817891"></script>





</body>
</html>
