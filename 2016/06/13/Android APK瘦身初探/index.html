
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  <meta name="baidu_union_verify" content="d1952c66cf48912e21c18c7c581f382a">
  <meta name="360-site-verification" content="67fbcc5a67f4c65c057315b28fa0b2c8" />
<meta name="google-site-verification" content="2GzxQ0VtXwTSUdmGm6DzcmhTzM_I9QmzCb_pzpMzD88" />
  
    <title>Android APK瘦身策略 | Atypical programmer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Cstsinghua">
    
    <meta name="description" content="引言随着Android技术的发展，以及用户需求的井喷，Android应用的APK大小也随着越来越“胖”，APK在安装和更新之前都需要经过网络将其下载到手机，如果APK越大消耗的流量就会越多，特别是对于使用移动网络的用户来讲，消耗流量越多就代表需要花更多的钱去购买流量。同时一些第三方应用商城也会对上传">
    
    
    
    
    <link rel="alternate" href="atom.xml" title="Atypical programmer" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            var _bdId ='391982416296a0d54221f59fe35250d4';
             hm.src = "//hm.baidu.com/hm.js?" + _bdId;
             var s = document.getElementsByTagName("script")[0]; 
             s.parentNode.insertBefore(hm, s);
        })();
    </script>
     
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Atypical programmer">Atypical programmer</a></h1>
				<a class="blog-motto">做一个非典型程序员</a>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/categories/Android">Android</a></li>
					
						<li><a href="/categories/Java">Java</a></li>
					
						<li><a href="/categories/Python">Python</a></li>
					
						<li><a href="/categories/杂项/">杂项</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
                                            <form class="search" action=http://zhannei.baidu.com/cse/search target="_blank">
                                            <label>Search</label>
                                        <input name="s" type="hidden" value= null ><input type="text" name="q" size="30" placeholder="搜索"><br>
					
					</li>
				</ul>
                            </nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/13/Android APK瘦身初探/" title="Android APK瘦身策略" itemprop="url">Android APK瘦身策略</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://github.com/cstsinghua" title="Cstsinghua">Cstsinghua</a>
    </p>
  <p class="article-time">
    <time datetime="2016-06-13T06:34:28.000Z" itemprop="datePublished">2016-06-13</time>
    更新日期:<time datetime="2016-06-13T06:34:35.834Z" itemprop="dateModified">2016-06-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#引言"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#APK文件结构"><span class="toc-number">2.</span> <span class="toc-text">APK文件结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#优化探讨"><span class="toc-number">3.</span> <span class="toc-text">优化探讨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#图片压缩工具介绍"><span class="toc-number">3.1.</span> <span class="toc-text">图片压缩工具介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
		</div>
		
		<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>随着Android技术的发展，以及用户需求的井喷，Android应用的APK大小也随着越来越“胖”，APK在安装和更新之前都需要经过网络将其下载到手机，如果APK越大消耗的流量就会越多，特别是对于使用移动网络的用户来讲，消耗流量越多就代表需要花更多的钱去购买流量。同时一些第三方应用商城也会对上传的APK大小有限制，所以为了能够让产品能够更受商城和用户欢迎，APK瘦身是第一步，更小的APK标示着更多地用户愿意去下载和体验。因此，APK瘦身大有必要！</p>
<h1 id="APK文件结构"><a href="#APK文件结构" class="headerlink" title="APK文件结构"></a>APK文件结构</h1><p>Android应用的APK文件其实就是一个压缩文件，可以用常规的压缩软件打开，查看其目录结构。为了能够减小APK的大小，首先需要知道APK由哪些部分构成，然后针对每个部分做相应的优化工作，下图是一个APK解压后的文件结构（各APK的结构核心内容是一致的，差异化的文件暂不关注）:</p>
<p><img src="http://i.imgur.com/nfreQFu.png" alt="APK目录结构"></p>
<p>各文件的介绍如下：</p>
<ul>
<li><p>classes.dex：classes.dex是java源码编译后生成的java字节码文件。但由于Android使用的dalvik虚拟机与标准的java虚拟机是不兼容的，dex文件与class文件相比，不论是文件结构还是opcode都不一样。Android模拟器中提供了一个dex文件的反编译工具，dexdump。用法为首先启动Android模拟器，把要查看的dex文件用adb push上传的模拟器中，然后通过adb shell登录，找到要查看的dex文件，执行dexdump xxx.dex（或者从压缩文件取出dex文件，直接在PC上面找到dexdump.exe的路径，然后执行命令）。另外Dedexer是一个反编译dex文件的开源工具，需要自己编译源代码。而当前，还有比如dex2jar甚至封装好的GUI的工具(比如安卓逆向助手等等)可以反编译dex文件为jar文件，再利用jd-gui工具打开jar文件，就可以阅读java源代码了。</p>
</li>
<li><p>resources.arsc：编译后的二进制资源文件</p>
</li>
<li><p>AndroidManifest.xml：清单文件，该文件是每个应用都必须定义和包含的，它描述了应用的名字、版本、权限、引用的库文件等等信息，如要把apk上传到Google Market上，也要对这个xml做一些配置。在apk中的AndroidManifest.xml是经过压缩的，可以通过AXMLPrinter2工具解开，具体命令为：java -jar AXMLPrinter2.jar AndroidManifest.xml</p>
</li>
<li><p>proguard.cfg：代码混淆配置文件(上图中暂无包括混淆配置)；</p>
</li>
<li><p>project.properties：标示APK的target sdk和依赖关系，这里的依赖关系指示的是该APK依赖到了哪些工程(上图中暂无包括依赖配置)；</p>
</li>
<li><p>assets：assets目录可以存放一些配置文件（比如webview本地资源、图片资源、音视频等等），这些文件的内容在程序运行过程中可以通过相关的API（android.content.res.AssetManager）获得。</p>
</li>
<li><p>lib：lib目录下的子目录armeabi存放的是一些so文件。这个地方多讲几句，都是在开发过程中摸索出来的。eclipse在打包的时候会根据文件名的命名规则（lib**.so）去打包so文件，开头和结尾必须分别为“lib”和“.so”，否则是不会打包到apk文件中的。其他非eclipse开发环境没有测试过。如果你是用SDK和NDK开发的话，这部分很重要，甚至可以通过把一些不是so文件的文件通过改名打包到apk中，具体能干些什么那就看你想干什么了，呵呵呵！</p>
</li>
<li><p>META-INF：META-INF目录下存放的是签名信息，用来保证apk包的完整性和系统的安全。在eclipse编译生成一个apk包时，会对所有要打包的文件做一个校验计算，并把计算结果放在META-INF目录下。这就保证了apk包里的文件不能被随意替换。比如拿到一个apk包后，如果想要替换里面的一幅图片，一段代码， 或一段版权信息，想直接解压缩、替换再重新打包，基本是不可能的。如此一来就给病毒感染和恶意修改增加了难度，有助于保护系统的安全。</p>
</li>
<li><p>res：res目录存放资源文件。包括图片、字符串、raw文件夹下面的音频文件、各种xml文件等等。</p>
</li>
</ul>
<h1 id="优化探讨"><a href="#优化探讨" class="headerlink" title="优化探讨"></a>优化探讨</h1><p>从前面的目录结构图分析可知，<strong>APK中classes.dex、lib、资源文件是大头，APK瘦身主要就是优化这三类</strong>，关于这三种类型的文件比较成熟的优化方法有：</p>
<ul>
<li><p><strong>classes.dex:</strong>这是减少apk文件至关重要的第一步。你要对自己的代码了如子掌。你要移除掉所有无用处的dependency libraries，让你的代码一天比一天优秀，持续地优化你的代码。总而言之，保持一个简洁，最新的代码基础是减少apk文件至关重要的一环。当然，从零开始一个项目并为这个项目保持一份简洁的代码基础很容易。项目越老，这个工作就越困难。事实上，拥有一大段历史背景的项目必须要去处理各种死代码和无用代码。还好有许多的开发工具可以帮我们来做这些事情……Proguard 是一个很强悍的工具，它可以帮你在代码编译时对代码进行混淆，优化和压缩。它有一个专门用来减少apk文件大小的功能叫做 tree-shaking。Proguard 会遍历你的所有代码然后找出无用处的代码。所有这些不可达（或者不需要）的代码都会在生成最终的apk文件之前被清除掉。Proguard 也会重命名你的类属性，类和接口，然整个代码尽可能地保持轻量级水平。也许现在你会认为 Proguard 是一个相当有效地工具。但是能力越大，责任也就越大。现在许多开发这认为Proguard有点让人不省心，因为它会重度依赖反射。哪些类或者属性需要被处理或者不能处理都要开发者对Proguard进行配置。但通过代码混淆，删掉不必要的jar包和代码可实现dex文件的优化；</p>
</li>
<li><p><strong>lib:</strong>一个硬件设备对应一个架构（mips、arm或者x86），只保留与设备架构相关的库文件夹（主流的架构都是arm的，mips属于小众，默认也是支持arm的so的，但x86的不支持），这样可以大大降低lib文件夹的大小；</p>
</li>
<li><p><strong>资源文件：</strong>Proguard 只会对 Java 代码起作用，那么对哪些资源文件呢？比如一张图片 my_image 在 res/drawable 文件夹中，没有被使用，Proguard 只会移除掉 R 类中的引用，但是图片依然还在文件夹中。Lint 一个静态的代码分析器，你只需通过调用 ./gradlew lint这个简单地命令它就能帮你检查所有无用的资源文件。它在检测完之后会提供一份详细的资源文件清单，并将无用的资源列在“UnusedResources: Unused resources” 区域之下。只要你不通过反射来反问这些无用资源，你就可以放心地移除这些文件了。Lint 会分析资源文件(比如 /res 文件夹下面的文件) ，但是会跳过 assets 文件 ( /assets 文件夹下面的文件)。事实上assets 文件是可以通过它们的文件名直接访问的，而不需要通过Java引用或者XML引用。因此，Lint 也不能判定某个 asset 文件在项目中是否有用。这全取决于开发者对这个文件夹的维护了。如果你没有使用某个asset 文件，那么你就可以直接清除这个文件。通过Lint工具扫描代码中没有使用到的静态资源。</p>
</li>
</ul>
<p>上面介绍的三种类型文件的优化方案的确能够在一定程度上减小APK的大小，但在最近做项目的过程中经过研究发现还可以更进一步优化APK的大小，具体方案如下：</p>
<ul>
<li><p>多分辨率适配：这里的水很深，网上也有很多文章介绍经验（比如一套图、一套布局，多套dimens.xml文件，在使用最小资源的情况下搞定多分辨率适配），Android官网也有专门的篇章介绍，详细研究可以参看；</p>
</li>
<li><p>预置数据：和游戏一样，程序和数据分离，进入模块时下载预置数据（下载的策略需要注重用户体验，在需要使用数据的地方下载）；</p>
</li>
<li><p>图片资源：压缩优化图片资源（<strong>图片资源的优化原则是：在不降低图片效果、保证APK显示效果的前提下缩小图片文件的大小。</strong>），或者使用新的图片格式，Aapt（Android Asset Packaging Tool）就内置了 保真图像压缩算法。例如，一个只需 256 色的真彩PNG图片会被aapt 通过一个颜色调色板转化成一个 8-bit PNG 文件。这可以帮助你减少图片文件的大小。当然你还可以通过Google查找相应的优化工具，比如 压缩png图片的常用工具有tinypng（<a href="https://tinypng.com" title="tinypng官网" target="_blank" rel="external">https://tinypng.com</a>）、pngquant（<a href="https://pngquant.org/" title="pngquant官网" target="_blank" rel="external">https://pngquant.org/</a>）、ImageAlpha 和 ImageOptim 等。还有一种只在Android平台上存在的图片文件也可以优化，它就是 9-patches。就目前所了解的情况，还没发现针对这类图片文件的高效优化工具。然而你只需要求你的设计师将它的可扩展区域和内容区域尽可能地减少即可。这不但可以减少资源文件的大小，还能使得以后资源文件的维护变得更加简单。你可以从中选择一个适合你的工具。而<strong>Android支持的新式的图片格式webP</strong>，下面详细介绍图片资源优化(压缩)的方案。</p>
</li>
</ul>
<h2 id="图片压缩工具介绍"><a href="#图片压缩工具介绍" class="headerlink" title="图片压缩工具介绍"></a>图片压缩工具介绍</h2><p><strong>1.tinypng：</strong></p>
<p>tinypng是一个支持压缩png和jpg图片格式的网站（<a href="https://tinypng.com" title="tinypng官网" target="_blank" rel="external">https://tinypng.com</a>），通过其独特的算法（通过一种叫“量化”的技术，把原本png文件的24位真彩色压缩为8位的索引演示，是一种矢量压缩方法，把颜色值用数值123等代替。）可以实现在无损压缩的情况下图片文件大小缩小到原来的30%-50%甚至更多。</p>
<p>tinypng的缺点是在压缩某些带有过渡效果（带alpha值）的图片时，图片会失真，这种图片可以将png图片转换为下面介绍的webP格式，可以在保证图片质量的前提下大幅缩小图片的大小。需要说明的是：tinypng支持png和jpg图片的压缩，并且也支持9图的压缩。</p>
<p>tinypng提供了开放接口供开发者开发属于自己的压缩工具，不过这是付费服务，对于普通用户来说，tinypng为每个用户提供的每月图片免费压缩数量（目前是500张/月）已经足够了。</p>
<p><strong>2.使用webP图片格式：</strong></p>
<p>WebP是谷歌研发出来的一种图片数据格式，它是一种支持有损压缩和无损压缩的图片文件格式，派生自图像编码格式 VP8。根据 Google 的测试，无损压缩后的 WebP 比 PNG 文件少了 45％ 的文件大小，即使这些 PNG 文件经过其他压缩工具压缩之后，WebP 还是可以减少 28％ 的文件大小。目前很多公司已经将webP技术运用到Android APP中，比如FaceBook、腾讯、淘宝。webP相比于png最明显的问题是加载稍慢，不过现在的智能设备硬件配置越来越高，这都不是事儿。</p>
<p> 假如你打算在 App 中使用 WebP，除了 Android4.0 以上提供的原生支持外，其他版本以可以使用官方提供的解析库webp-android-backport编译成so使用。</p>
<p> 通常UI提供的图片都是png或者jpg格式，我们可以通过智图或者isparta将其它格式的图片转换成webP格式，isparta可实现批量转换，墙裂推荐！</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>APK瘦身是一个系统工程，不可能一蹴而就，而且与APK的体验及功能等密切相关，不能顾此失彼，既要保证APK和画面的质量，又要尽量减少APK的体积，因此，需要综合考虑各个因素，做出更优的策略。</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/APK瘦身/">APK瘦身</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>



<div class="article-share" id="share">

  <div data-url="https://github.com/cstsinghua/2016/06/13/Android APK瘦身初探/" data-title="Android APK瘦身策略 | Atypical programmer" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/06/13/Android studio动态调试指南/" title="Android studio动态调试">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Android studio动态调试</span>
</a>
</div>


<div class="next">
<a href="/2016/06/13/python安装第三方包错误解决/"  title="python安装某些第三方包报错解决办法">
 <strong>NEXT:</strong><br/> 
 <span>python安装某些第三方包报错解决办法
</span>
</a>
</div>

</nav>

	
<section class="comment">
	
	<div class="ds-thread" data-title="Android APK瘦身策略" data-thread-key="Android APK瘦身初探" data-author-key="Cstsinghua" data-url="https://github.com/cstsinghua/post/Android APK瘦身初探"></div>
	
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#引言"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#APK文件结构"><span class="toc-number">2.</span> <span class="toc-text">APK文件结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#优化探讨"><span class="toc-number">3.</span> <span class="toc-text">优化探讨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#图片压缩工具介绍"><span class="toc-number">3.1.</span> <span class="toc-text">图片压缩工具介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	<div class="social-list" class="clearfix">
		
		
		
		<a href="https://github.com/cstsinghua" target="_blank" title="github"></a>
		
		
		
	</div>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android/" title="Android">Android<sup>9</sup></a></li>
		
			<li><a href="/categories/Python/" title="Python">Python<sup>1</sup></a></li>
		
			<li><a href="/categories/杂项/" title="杂项">杂项<sup>2</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/APK安装/" title="APK安装">APK安装<sup>1</sup></a></li>
		
			<li><a href="/tags/APK瘦身/" title="APK瘦身">APK瘦身<sup>1</sup></a></li>
		
			<li><a href="/tags/Android热修复/" title="Android热修复">Android热修复<sup>1</sup></a></li>
		
			<li><a href="/tags/Apktool打包/" title="Apktool打包">Apktool打包<sup>1</sup></a></li>
		
			<li><a href="/tags/Push/" title="Push">Push<sup>1</sup></a></li>
		
			<li><a href="/tags/Zxing/" title="Zxing">Zxing<sup>1</sup></a></li>
		
			<li><a href="/tags/动态加载/" title="动态加载">动态加载<sup>1</sup></a></li>
		
			<li><a href="/tags/动态调试/" title="动态调试">动态调试<sup>2</sup></a></li>
		
			<li><a href="/tags/安装第三方包/" title="安装第三方包">安装第三方包<sup>1</sup></a></li>
		
			<li><a href="/tags/搭建个人Blog/" title="搭建个人Blog">搭建个人Blog<sup>1</sup></a></li>
		
			<li><a href="/tags/杂项/" title="杂项">杂项<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
      <li><a href="http://gengbiao.me" target="_blank" title="coney">coney's Blog</a></li>
	  <li><a href="http://haiolv.github.io/" target="_blank" title="haiolv">haiolv's Blog</a></li>
	  <li><a href="http://aso210.github.io/" target="_blank" title="aso210">aso210's Blog</a></li>
	  <li><a href="http://hellokugo.github.io/" target="_blank" title="hellokugo">hellokugo's Blog</a></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/APK安装/" style="font-size: 10px;">APK安装</a> <a href="/tags/APK瘦身/" style="font-size: 10px;">APK瘦身</a> <a href="/tags/Android热修复/" style="font-size: 10px;">Android热修复</a> <a href="/tags/Apktool打包/" style="font-size: 10px;">Apktool打包</a> <a href="/tags/Push/" style="font-size: 10px;">Push</a> <a href="/tags/Zxing/" style="font-size: 10px;">Zxing</a> <a href="/tags/动态加载/" style="font-size: 10px;">动态加载</a> <a href="/tags/动态调试/" style="font-size: 20px;">动态调试</a> <a href="/tags/安装第三方包/" style="font-size: 10px;">安装第三方包</a> <a href="/tags/搭建个人Blog/" style="font-size: 10px;">搭建个人Blog</a> <a href="/tags/杂项/" style="font-size: 10px;">杂项</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
    
            <p class="copyright"> © 2016 
		
		<a href="https://github.com/cstsinghua" target="_blank" title="Cstsinghua">Cstsinghua</a>
		
            && Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney">coney</a>
            </div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 






<script>
    
        var _bdImg = '2';
    
    window._bd_share_config={
        "common":{
            "bdSnsKey":{

            },
            "bdText":"",
            "bdMini":"2",
            "bdMiniList":[
                "qzone",
                "tsina",
                "weixin",
                "renren",
                "tqq",
                "tieba",
                "douban",
                "sqq",
                "diandian",
                "huaban",
                "youdao",
                "mail",
                "ty",
                "fbook",
                "twi",
                "linkedin",
                "copy",
                "print"
            ],
            "bdPic":"",
            "bdStyle":"0",
            "bdSize":"16"
        },
        "slide":{
            "type":"slide",
            "bdImg":_bdImg,
            "bdPos":"right",
            "bdTop":"350"
        },
        "image":{
            "viewList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ],
            "viewText":"分享：",
            "viewSize":"16"
        },
        "selectShare":{
            "bdContainerClass":null,
            "bdSelectMiniList":[
                "weixin",
                "qzone",
                "tsina",
                "renren",
                "douban",
                "tqq"
            ]
        }
    };
    with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>




<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'null', 'null');  
ga('send', 'pageview');
</script>


  </body>
</html>

